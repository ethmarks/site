---
import sharp from "sharp";
import { Image } from "astro:assets";

const { image, url, alt, title, desc, transparent } = Astro.props;

let dominantColor = "rgba(0,0,0,0)";

if (image.fsPath && !transparent) {
    const stats = await sharp(image.fsPath).stats();
    const [r, g, b] = stats.channels.map((c) => Math.round(c.mean));
    dominantColor = `rgb(${r}, ${g}, ${b})`;
}
---

<div class="card">
    <a href={url} class="card-link">
        <Image
            src={image}
            alt={alt}
            style={`background: ${dominantColor}`}
            class="card-image"
        />
        <h4>{title}</h4>
        <p>{desc}</p>
    </a>
</div>

<style>
    :root {
        --card-gap: var(--spacing-lg);
        --card-padding: var(--spacing-lg);
    }

    .card {
        background: var(--color-card);
        border-radius: var(--radius-lg);
        border: var(--border-light);
        transition: var(--transition-transform-shadow);
        box-shadow: var(--shadow-standard);
        overflow: hidden;

        &:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-standard-hover);
            border-color: var(--color-accent-transparent-30);
        }

        .card-link {
            display: block;
            color: var(--color-text);
            text-decoration: none;
            height: 100%;
            box-sizing: border-box;

            .card-image {
                width: 100%;
                height: 160px;
                object-fit: cover;
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
                transition: var(--transition-default);
            }

            h4 {
                margin: 0 0 var(--spacing-xs) 0;
                padding: 0 var(--card-padding);
                padding-top: var(--spacing-md);
                font-size: var(--font-size-h4);
                font-family: var(--font-secondary);
                color: var(--color-link);
                line-height: 1.3;
            }

            p {
                margin: 0;
                padding: 0 var(--card-padding) var(--card-padding);
                font-size: var(--font-size-sm);
                color: var(--color-text-secondary);
                line-height: 1.5;
            }

            &:hover {
                text-decoration: none;

                .card-image {
                    transform: scale(1.05);
                }

                h4 {
                    color: var(--color-accent-light);
                }
            }
        }
    }
</style>
